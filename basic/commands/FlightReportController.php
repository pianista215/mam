<?php
namespace app\commands;

use yii\console\Controller;
use yii\console\ExitCode;

class FlightReportController extends Controller
{
    /**
     * This command assemble the flight report sent by acars in flights where all chunks have been uploaded.
     * @return int Exit code
     */
    public function actionAssembleChunks()
    {
        $this->stdout("Assembling flight report chunks...\n");

        // TODO: buscar en DB los vuelos con estado pendiente
        // TODO: ensamblar los ficheros chunk en uno solo
        // TODO: descomprimir si es gzip
        // TODO: guardar fichero resultante con nombre identificable

        $this->stdout("Done.\n");
        return ExitCode::OK;
    }

    /**
     * Import events and analysis generated by mam-analyzer for a flight report.
     */
    public function actionImportReportAnalysis()
    {
        $this->stdout("Importing analyzed report...\n");

        // TODO: buscar en /data/processed/ los json ya analizados
        // TODO: parsear el contenido
        // TODO: poblar tablas en DB con ActiveRecord
        // TODO: actualizar estado del vuelo

        $this->stdout("Done.\n");
        return ExitCode::OK;
    }
}
